---
name: test-check
description: テスト整合性の静的チェック。変更ファイルに対応するテストの存在確認と更新を機械的に行う。
---

# テスト整合性チェック（静的ルール）

## CRITICAL: このスキルは必須実行

**このスキルの実行をスキップした場合、タスクは未完了として扱われる。**

実装作業を終える前に、必ず以下の手順を実行すること。テストの確認・作成・更新なしにPR作成やタスク完了報告をしてはならない。

## 実行タイミング

以下のタイミングで**必ず**このスキルを実行する：

1. **実装完了後、コミット前** - 変更ファイルに対応するテストを確認
2. **PR作成前** - 全テストが通ることを確認

## 基本ルール

**テストなしでの実装完了は認めない。これは絶対的なルールである。**

## 静的チェック手順（MUST実行）

### Step 1: 変更ファイルの列挙

変更された `.ts` / `.js` / `.tsx` / `.jsx` ファイルを列挙する。
ただし以下は除外：
- `*.test.ts`, `*.spec.ts`（テストファイル自体）
- `*.d.ts`（型定義のみ）
- `types/` 配下（型定義のみ）

### Step 2: 対応テストファイルの確認

各ソースファイルに対して、以下のルールで対応テストファイルを特定：

| ソースファイル | 対応テストファイル |
|--------------|------------------|
| `src/foo.ts` | `src/foo.test.ts` |
| `src/bar/baz.ts` | `src/bar/baz.test.ts` |

### Step 3: アクション実行（REQUIRED）

対応テストファイルの状態に応じてアクションを**必ず**実行する：

| 状態 | アクション | 備考 |
|-----|----------|------|
| テストファイルが**存在しない** | **作成する** | スキップ不可 |
| テストファイルが**存在する** | **確認・更新する** | 変更内容との整合性を確認 |

**重要**: 「テストファイルが存在するから何もしなくてよい」は誤り。既存テストが変更内容をカバーしているか必ず確認し、必要なら更新する。

### Step 4: テスト実行（REQUIRED）

`npm test` を実行し、全テストが通ることを確認する。失敗がある場合は修正してから次に進む。

## 完了条件チェックリスト

**以下の全項目を満たさない限り、タスク完了とは認められない：**

変更された各ソースファイルについて：

- [ ] 対応する `.test.ts` ファイルが存在するか確認した
- [ ] 存在しない場合、テストファイルを**作成した**
- [ ] 存在する場合、テスト内容が変更に対応しているか**確認した**
- [ ] テストが変更を反映していない場合、**更新した**
- [ ] 新規追加した関数/クラスのテストを**追加した**
- [ ] `npm test` が**全て通ることを確認した**

**上記チェックリストを実行せずにタスク完了を報告することは禁止。**

## 例

### 例1: 新規ファイル作成時

```
変更ファイル: src/core/init.ts (新規)

チェック:
- src/core/init.test.ts は存在しない

アクション:
- src/core/init.test.ts を作成
- init.ts の全export関数のテストを追加
```

### 例2: 既存ファイル変更時（重要）

```
変更ファイル: src/hooks/create-issue.ts (変更)
- parsePlanFromInput関数を削除
- parsing.tsからインポートに変更

チェック:
- src/hooks/create-issue.test.ts は存在する
- しかし、テストはparsePlanFromInputを内部で再実装してテストしている
- 本体の変更（関数削除・インポート変更）がテストに反映されていない

アクション:
- create-issue.test.ts を確認
- 本体から削除された関数のテストを削除または移動
- 新しいインポート構造に合わせてテストを更新
- テストと本体の整合性を確保
```

**注意**: テストファイルが「存在する」だけでは不十分。本体の変更がテストに反映されているか必ず確認する。

## 除外条件

以下の場合**のみ**テスト作成/更新をスキップしてよい：

- 型定義のみの変更（`types/index.ts` など）
- 設定ファイルの変更（`tsconfig.json` など）
- ドキュメントのみの変更

## 最終確認

**タスク完了前に必ず自問する：**

1. 変更した全ての`.ts`ファイルに対応するテストを確認したか？
2. テストが存在しない場合、作成したか？
3. テストが存在する場合、変更内容との整合性を確認したか？
4. `npm test`は全て通るか？

**1つでも「いいえ」がある場合、タスクは未完了である。**
